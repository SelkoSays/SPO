\documentclass[a4paper,notitlepage]{article}
\usepackage[utf8]{inputenc}
\usepackage{minted}
\usepackage{cite}
\usepackage{svg}
\usepackage{hyperref}
\usepackage{url}
\usepackage{hyphenat}
\usepackage[slovene]{babel}
\usepackage{titling}
\usepackage{tikz}
\usepackage{fvextra}
\usepackage{dirtree}

\DefineVerbatimEnvironment{mateusz}
  {Verbatim}
  {fontfamily=\rmdefault,breaklines,breaksymbolleft={}}
% tlmgr install transparent titling svg upquote minted latexindent hyphenat dirtree
\tikzset{%
    baseline,
    inner sep=2pt,
    minimum height=12pt,
    rounded corners=2pt
}
\newcommand{\inline}[1]{\mbox{% added this percent
        \ttfamily
        \tikz \node[anchor=base,fill=black!12]{#1};% added this percent
    }}
\newcommand{\code}[1]{\mintinline[breaklines]{c}{#1}}

\hbadness=500000
\tolerance=10000

\usemintedstyle{sas}


\author{Jan Mrak \\
    \small Fakulteta za računalništvo in informatiko, Univerza v Ljubljani}
\title{Razhroščevalnik\\
    \small Seminarska naloga pri predmetu Sistemska programska oprema
    \\
    \small Mentor: doc. Tomaž Dobravec}
\date{\today}

\begin{document}

\maketitle
\thispagestyle{empty}

\begin{abstract}
	Predstavitev implementacije in delovanja rezhroščevalnika na različnih platformah in za različne jezike.
\end{abstract}

\section{Uvod}

Razhroščevalnik je program, ki nam omogoča testiranje in upravljanje nekega drugega programa. Omogoča nam branje in pisanje spomina in registrov, poljubno ustavljanje programa, izvajanje po vrsticah ali ukazih in drugo.
Poznamo različne razhroščevalnike, kot so GDB, LLDB, x64dbg, ki so bolj generalni. Obstajajo pa tudi drugačni razhroščecalniki, kot je Valgrind, ki nam omogoča pregled nad pomnilnikom procesa in recimo zaznava uhajanje spomina (angl. memory leak).

\section{Razhroščevalnik na sistemu Linux}

Na Unix in Unix-like sistemih je ponujen sistemski klic
\begin{minted}{c}
    long ptrace(enum __ptrace_request op, pid_t pid, void *addr, void *data);    
\end{minted}
, ki nam omogoča, da lahko dostopamo do prcesa podanega s \code{pid}. Da pa bo sistemski klic uspel, mora proces, do katerega želimo dostopati, dovoliti dostop do njega.
To pa lahko naredi s klicem sistemske funkcije \code{ptrace}:
\begin{minted}{c}
    // pid, addr in data argumenti so ignorirani
    ptrace(PTRACE_TRACEME, 0, NULL, NULL);
\end{minted}

Po tem bo razhroščevalnik lahko dostopal do tega procesa.

Razhroščevalnik lahko sam ustvari proces, ki potem pokliče \code{ptrace} z argumentom \code{PTRACE_TRACEME},

\begin{minted}{c}
    int pid = fork();
    if (pid == 0) {
        ptrace(PTRACE_TRACEME, 0, NULL, NULL);
        execve(...);
    }
\end{minted}

lahko pa se priklopi na nek obstoječi proces z uporabo \code{PTRACE_ATTACH}, ki pošlje signal \code{SIGSTOP}, da se proces ustavi, ali pa \code{PTRACE_SEIZE}, ki ne ustavi procesa.

\begin{minted}{c}
    ptrace(PTRACE_ATTACH, pid, NULL, NULL);
    // ali
    ptrace(PTRACE_SEIZE, pid, NULL, PTRACE_O_flags);
\end{minted}

Če želimo ustaviti proces, ga lahko ustavimo kadarkoli s klicem \code{ptrace} in za argument \code{op} izberemo \code{PTRACE_INTERRUPT}.
Ko pa proces ustavimo, imamo na voljo veliko različnih možnosti za upravljanje s procesom.

Možnosti za pridobivanje in upravljanje z informacijami:
\begin{itemize}
    \item \code{PTRACE_PEEKDATA} ali \code{PTRACE_PEEKTEXT}, ki nam omogočata, da beremo iz procesovega spomina
    \item \code{PTRACE_POKEDATA} ali \code{PTRACE_POKETEXT}, ki nam omogočata, da pišemo v spomin procesa
    \item \code{PTRACE_GETREGS} ali \code{PTRACE_GETFREGS}, ki nam omogočata, da preberemo splošno namenske registre ali registre za delanje s plavajočo vejico
    \item \code{PTRACE_SETREGS} ali \code{PTRACE_SETFREGS}, podobno kot pri prejšnjem primeru, dobimo dostop do registrov in v njih lahko zapišemo vrednosti
    \item \code{PTRACE_GETSIGINFO}, ki pridobi informacije o signalu, ki je ustavil proces
    \item \code{PTRACE_PEEKSIGINFO}, enako pridobi informacije o signalu, vendar ga ne vzame iz vrste signalov
\end{itemize}

Možnosti za upravljanje poteka procesa:
\begin{itemize}
    \item \code{PTRACE_CONT}, ki znova zažene ustavljen proces, da nadaljuje z delovanjem
    \item \code{PTRACE_SINGLESTEP}, ki izvede le en ukaz
    \item \code{PTRACE_SYSCALL}, ki se vede kot \code{PTRACE_CONT}, vendar se preces, ki ga razhroščijemo ustavi tik pred vstopom v sistemski klic, oziroma ob izstopu sistemskega klica
    \item \code{PTRACE_KILL}, ki procesu pošlje signal \code{SIGKILL} in ga tako prisilno zaključi
    \item \code{PTRACE_INTERRUPT}, ki ustavi proces
\end{itemize}

Obstaja še veliko drugih možnosti za delo s procesom, ki pa so razložene v priročniku man za ptrace\cite{ptrace-man-page}.

\subsection{DWARF format}

Razhroščevalnik nam ponavadi ponujajo tudi neke dodatne možnosti in olajšave pri razhroščevanju programa, ki pa so omogočene kadar imamo na voljo informacije o programu oz, razhroščevalne informacije (angl. debug information).
To pa nas pripelje do datotečnega formata razhroščevalnih informacij \code{DWARF} (Debugging With Arbitrary Record Formats)\cite{dwarf-web-page}, ki je široko uporabljen na Unix, Linux in drugih operacijskih sistemih.



\section{Razhroščevalnik na sistemu Windows}


\section{Razhroščevalnik za jezik Java / Python ?}

\nocite{*} % show all sources
\bibliographystyle{plain}
\bibliography{refs}

\end{document}